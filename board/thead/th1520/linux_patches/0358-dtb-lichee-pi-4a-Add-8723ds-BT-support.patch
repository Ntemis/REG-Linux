From b2261096e8023b08cf5d644d522de13a890ced69 Mon Sep 17 00:00:00 2001
From: NekoRouter <nekorouter@outlook.com>
Date: Fri, 24 Jan 2025 15:44:59 +0800
Subject: [PATCH 358/400] dtb: lichee-pi-4a: Add 8723ds BT support config:
 enable BT_HCIUART_RTL for 8723ds BT

Signed-off-by: NekoRouter <nekorouter@outlook.com>
---
 .../boot/dts/thead/th1520-lichee-pi-4a.dts     | 18 ++++++++++++++++++
 arch/riscv/configs/revyos_defconfig            |  2 +-
 2 files changed, 19 insertions(+), 1 deletion(-)

diff --git a/arch/riscv/boot/dts/thead/th1520-lichee-pi-4a.dts b/arch/riscv/boot/dts/thead/th1520-lichee-pi-4a.dts
index 0daf65807b31..98b126511036 100644
--- a/arch/riscv/boot/dts/thead/th1520-lichee-pi-4a.dts
+++ b/arch/riscv/boot/dts/thead/th1520-lichee-pi-4a.dts
@@ -998,6 +998,16 @@ rx-pins {
 			input-schmitt-enable;
 			slew-rate = <0>;
 		};
+
+		ctrl-pins {
+			pins = "UART4_CTSN", "UART4_RTSN";
+			function = "uart";
+			bias-disable;
+			drive-strength = <3>;
+			input-enable;
+			input-schmitt-disable;
+			slew-rate = <0>;
+		};
 	};
 
 	pinctrl_wifi_wake: wifi_grp {
@@ -1079,6 +1089,14 @@ &uart4 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&uart4_pins>;
 	status = "okay";
+	uart-has-rtscts;
+
+	bluetooth {
+		compatible = "realtek,rtl8723ds-bt";
+		device-wake-gpios = <&gpio0 28 GPIO_ACTIVE_HIGH>; /* GPIO02 */
+		host-wake-gpios = <&ioexp2 7 GPIO_ACTIVE_HIGH>;
+		enable-gpios = <&ioexp2 5 GPIO_ACTIVE_HIGH>;
+	};
 };
 
 &usb {
diff --git a/arch/riscv/configs/revyos_defconfig b/arch/riscv/configs/revyos_defconfig
index d4805726efe3..d8ce0f2db735 100644
--- a/arch/riscv/configs/revyos_defconfig
+++ b/arch/riscv/configs/revyos_defconfig
@@ -555,8 +555,8 @@ CONFIG_BT_HCIBTUSB_AUTOSUSPEND=y
 CONFIG_BT_HCIBTUSB_MTK=y
 CONFIG_BT_HCIBTSDIO=m
 CONFIG_BT_HCIUART=m
-CONFIG_BT_HCIUART_RTL3WIRE=y
 CONFIG_BT_HCIUART_BCM=y
+CONFIG_BT_HCIUART_RTL=y
 CONFIG_BT_MRVL=m
 CONFIG_BT_MRVL_SDIO=m
 CONFIG_BT_ATH3K=m
-- 
2.43.0

