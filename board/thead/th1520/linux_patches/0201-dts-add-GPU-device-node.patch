From e6274343bd11920765656a5f537dd758d5515ac9 Mon Sep 17 00:00:00 2001
From: Han Gao <gaohan@iscas.ac.cn>
Date: Sun, 1 Sep 2024 00:34:08 +0800
Subject: [PATCH 201/400] dts: add GPU device node

Signed-off-by: Han Gao <gaohan@iscas.ac.cn>
---
 arch/riscv/boot/dts/thead/th1520-a-val.dtsi       |  4 ++++
 arch/riscv/boot/dts/thead/th1520-lichee-pi-4a.dts |  4 ++++
 arch/riscv/boot/dts/thead/th1520.dtsi             | 15 +++++++++++++++
 3 files changed, 23 insertions(+)

diff --git a/arch/riscv/boot/dts/thead/th1520-a-val.dtsi b/arch/riscv/boot/dts/thead/th1520-a-val.dtsi
index c51b8d63ebe9..54e5fa749393 100644
--- a/arch/riscv/boot/dts/thead/th1520-a-val.dtsi
+++ b/arch/riscv/boot/dts/thead/th1520-a-val.dtsi
@@ -1477,6 +1477,10 @@ &gpio3 {
 			  "GPIO10";
 };
 
+&gpu {
+	status = "okay";
+};
+
 &npu {
 	vha_clk_rate = <1000000000>;
 	status = "okay";
diff --git a/arch/riscv/boot/dts/thead/th1520-lichee-pi-4a.dts b/arch/riscv/boot/dts/thead/th1520-lichee-pi-4a.dts
index 0717b2ee6e65..f09481581ba2 100644
--- a/arch/riscv/boot/dts/thead/th1520-lichee-pi-4a.dts
+++ b/arch/riscv/boot/dts/thead/th1520-lichee-pi-4a.dts
@@ -1245,6 +1245,10 @@ &xtensa_dsp1 {
 	memory-region = <&dsp1_mem>;
 };
 
+&gpu {
+	status = "okay";
+};
+
 &npu {
 	vha_clk_rate = <1000000000>;
 	status = "okay";
diff --git a/arch/riscv/boot/dts/thead/th1520.dtsi b/arch/riscv/boot/dts/thead/th1520.dtsi
index 28b8a4b8e9af..66ac3a3f8a00 100644
--- a/arch/riscv/boot/dts/thead/th1520.dtsi
+++ b/arch/riscv/boot/dts/thead/th1520.dtsi
@@ -2206,6 +2206,21 @@ opp-396000000 {
 			};
 		};
 
+		gpu: gpu@ffef400000 {
+			compatible = "img,gpu";
+			reg = <0xff 0xef400000 0x0 0x100000>;
+			interrupts = <102 IRQ_TYPE_LEVEL_HIGH>;
+			interrupt-names = "gpuirq";
+			vosys-regmap = <&vosys_reg>;
+			power-domains = <&pd TH1520_AON_GPU_PD>;
+			clocks = <&vosys_clk_gate TH1520_CLKGEN_GPU_CORE_CLK>,
+					<&vosys_clk_gate TH1520_CLKGEN_GPU_CFG_ACLK>;
+			clock-names = "cclk", "aclk";
+			gpu_clk_rate = <18000000>;
+			dma-mask = <0xf 0xffffffff>;
+			status = "disabled";
+		};
+
 		iso7816: iso7816-card@fff7f30000 {
 			compatible = "xuantie,th1520-iso7816-card";
 			reg = <0xff 0xf7f30000 0x0 0x4000>;
-- 
2.43.0

