From 60b2c2b80e3f37493d364a53280d596881b14d08 Mon Sep 17 00:00:00 2001
From: Han Gao <gaohan@iscas.ac.cn>
Date: Sun, 1 Sep 2024 02:28:37 +0800
Subject: [PATCH 314/400] Fix panel-jadard-jd9365da panel driver problem

Signed-off-by: Han Gao <gaohan@iscas.ac.cn>
---
 drivers/gpu/drm/verisilicon/dw_mipi_dsi.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/verisilicon/dw_mipi_dsi.c b/drivers/gpu/drm/verisilicon/dw_mipi_dsi.c
index aeca3842bfef..fbea5de9ef31 100644
--- a/drivers/gpu/drm/verisilicon/dw_mipi_dsi.c
+++ b/drivers/gpu/drm/verisilicon/dw_mipi_dsi.c
@@ -634,9 +634,9 @@ static u32 dw_mipi_dsi_get_hcomponent_lbcc(struct dw_mipi_dsi *dsi,
 								const struct drm_display_mode *mode,
 								u32 hcomponent)
 {
-	u32 frac, lbcc;
+	u64 frac, lbcc;
 
-	lbcc = hcomponent * dsi->lane_link_rate / 8;
+	lbcc = (u64)hcomponent * (u64)dsi->lane_link_rate / 8;
 
 	frac = lbcc % mode->clock;
 	lbcc = lbcc / mode->clock;
@@ -1132,6 +1132,8 @@ static int dsi_runtime_suspend(struct device *dev)
 {
 	struct dw_mipi_dsi *dsi = dev_get_drvdata(dev);
 
+	msleep(5);
+
 	clk_disable_unprepare(dsi->pixclk);
 	clk_disable_unprepare(dsi->pclk);
 
-- 
2.43.0

